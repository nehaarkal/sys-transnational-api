<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:wsc="http://www.mulesoft.org/schema/mule/wsc"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/wsc http://www.mulesoft.org/schema/mule/wsc/current/mule-wsc.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	
	<sub-flow name="sys-transnational-impl-main-flow" doc:id="5baeca88-6ffa-43e1-b020-7df09bc281ec" >
		<ee:transform doc:name="get-attributes" doc:id="cdbe0a9c-8d9b-4f16-bda0-469ee2c87112" >
			<ee:variables >
				<ee:set-variable variableName="transportType" ><![CDATA[attributes.uriParams.'transportType']]></ee:set-variable>
				<ee:set-variable variableName="transportCompany" ><![CDATA[attributes.uriParams.'transportCompany']]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<ee:transform doc:name="request-external-transnational-api" doc:id="24d1a207-8204-43ff-8bd3-ff4ec96564bc" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/xml
---
{
	"soapenv:Envelope" @("xmlns:soapenv": "http://schemas.xmlsoap.org/soap/envelope/", "xmlns:book": "http://www.example.org/Bookings/"): {
		"soapenv:Header": "",
		"soapenv:Body": {
			"book:getRoutes": {
				"in": "Hello First Booking"
				} 
			}
		}
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<flow-ref doc:name="external-transnational-api-call-sub-flow" doc:id="71681fc6-570d-4531-be59-86890e6f5158" name="external-transnational-api-call-sub-flow"/>
		<ee:transform doc:name="transform-xml-to-json" doc:id="e9c86488-cafc-4abc-a901-11f40f431ef7" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
read(payload.body.Envelope.Body.getRoutesResponse.out, "application/xml")]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<ee:transform doc:name="response-mapping" doc:id="854de689-56d1-4d7e-a5f7-a24e49969829" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload.*ROUTELIST map (value,key) -> {
    "originLocation": {
      "locationCode": value.ROUTEINFO.ORIGIN 
      },
    "destinationLocation": {
      "locationCode": value.ROUTEINFO.DESTINATION 
      }
  }]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>

